# 自动登出功能说明

## 功能概述

自动登出功能是一个安全特性，当用户长时间不操作时，系统会自动登出用户以保护账户安全。

## 工作原理

### 1. 空闲检测
- 系统监听用户的鼠标、键盘、触摸等操作
- 10分钟内无任何操作时触发警告
- 页面切换时重置计时器

### 2. 警告弹窗
- 显示"会话即将超时"警告
- 30秒倒计时显示剩余时间
- 提供"继续使用"按钮

### 3. 自动登出
- 30秒内无操作自动登出
- 清除认证cookie
- 重定向到登录页面

## 用户操作

### 延长会话
- 点击"继续使用"按钮
- 计时器重置为10分钟
- 继续正常使用系统

### 自动登出后
- 需要重新登录
- 所有未保存的数据会丢失
- 建议定期保存重要信息

## 技术实现

### 前端组件
- `AutoLogoutService`: 核心服务类
- `AutoLogoutProvider`: React上下文提供者
- 集成在所有受保护的页面中

### 事件监听
- `mousedown`: 鼠标按下
- `mousemove`: 鼠标移动
- `keypress`: 键盘输入
- `scroll`: 页面滚动
- `touchstart`: 触摸开始
- `click`: 点击事件
- `visibilitychange`: 页面可见性变化

### 配置参数
- `IDLE_TIMEOUT`: 10分钟 (600,000毫秒)
- `WARNING_DURATION`: 30秒 (30,000毫秒)

## 测试功能

访问 `/test-auto-logout` 页面可以：
- 查看倒计时显示
- 测试计时器控制
- 了解功能说明

## 安全考虑

### 优势
- 防止未授权访问
- 保护用户隐私
- 减少安全风险

### 注意事项
- 确保重要数据已保存
- 了解自动登出时间
- 及时响应警告提示

## 自定义配置

如需修改时间设置，可以在 `src/services/autoLogout.ts` 中调整：

```typescript
private readonly IDLE_TIMEOUT = 10 * 60 * 1000; // 10分钟
private readonly WARNING_DURATION = 30 * 1000;   // 30秒
```

## 故障排除

### 常见问题

1. **功能不工作**
   - 检查是否已登录
   - 确认cookie设置正确
   - 查看浏览器控制台错误

2. **计时器异常**
   - 刷新页面重置服务
   - 检查JavaScript是否启用
   - 清除浏览器缓存

3. **弹窗不显示**
   - 检查z-index设置
   - 确认没有CSS冲突
   - 验证DOM元素创建

### 调试模式

在浏览器控制台中：
```javascript
// 检查服务状态
console.log('AutoLogout service:', window.autoLogoutService);

// 手动触发警告
window.autoLogoutService?.showWarning();
```

## 浏览器兼容性

- ✅ Chrome 60+
- ✅ Firefox 55+
- ✅ Safari 12+
- ✅ Edge 79+
- ⚠️ IE 11 (部分支持)

## 更新日志

### v1.0.0
- 初始版本发布
- 基本空闲检测功能
- 警告弹窗和倒计时
- 自动登出机制

### 计划功能
- 可配置的时间设置
- 用户偏好保存
- 多语言支持
- 移动端优化


